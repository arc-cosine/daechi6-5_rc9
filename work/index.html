<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>1인 1역 표 생성기</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 20px;
        }
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 80%;
            max-width: 1000px;
            margin: 0 auto 20px auto;
            padding: 0 10px;
            box-sizing: border-box;
        }
        h2 {
            margin: 0;
            font-size: 24px;
        }
        .button-container {
            display: flex;
            gap: 10px;
        }
        button {
            padding: 10px 20px;
            max-width : 50px;
            font-size: 16px;
            cursor: pointer;
        }
        table {
            border-collapse: collapse;
            width: 80%;
            max-width: 1000px;
            margin: 20px auto;
            text-align: center;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
        }
        th {
            background-color: #f2f2f2;
        }
        #currentWeekDisplay {
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: bold;
            color: #555;
            text-align: center;
        }
        @media print {
            @page {
                size: A4;
                margin: 0.8cm;
            }
            body {
                margin: 0;
                padding: 0;
                overflow: visible !important;
            }
            .header-container, button {
                display: none;
            }
            #currentWeekDisplay {
                text-align: left;
                margin-bottom: 15px;
                font-size: 15px;
                color: #000;
                padding-left: 0.8cm;
            }
            table {
                display: inline-block;   /* 옆으로 나란히 */
                vertical-align: top;     /* 위쪽 맞춤 */
                width: 100%;              /* 절반씩 차지 */
                border-collapse: collapse;
                page-break-inside: auto;
                margin: 0;               /* 여백 제거 */
            }
            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }
            td, th {
                border: 1px solid #000;
                padding: 7px;
                font-size: 11px;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            th:nth-child(4),
            td:nth-child(4) {
                display: none;
            }
        }

    </style>
</head>
<body>
<div class="header-container">
    <h2>1인 1역 표</h2>
    <div class="button-container">
        <button id="printButton">인쇄</button>
        <button id="frontWeekButton">이전주</button>
        <button id="nextWeekButton">다음주</button>
        <button id="resetButton">초기화</button>
        <button id="fillDefaultButton">기본값 채우기</button>
        <button id="saveButton" >반영</button>
        <button id="viewButton" >값 보기</button>
        <button id="loadFromJsonbinButton">저장된 값 불러오기</button>

        <!-- 모달 구조 -->
        <div id="valueModal" style="display: none; position: fixed; top: 0; left: 0;
  width: 100vw; height: 100vh; background: rgba(0,0,0,0.6); z-index: 9999;
  justify-content: center; align-items: center;">
            <div style="background: white; padding: 20px; border-radius: 10px; max-width: 400px; text-align: center;">
                <h3>저장된 주급 데이터</h3>
                <pre id="modalContent" style="margin-top: 10px; text-align: left;"></pre>
                <button id="closeModal" style="margin-top: 15px;">닫기</button>
            </div>
        </div>
    </div>
</div>

<div id="currentWeekDisplay"></div>

<table>
    <thead>
    <tr>
        <th>학생 이름</th>
        <th>역할</th>
        <th>주급</th>
        <th>실수령액 (소득세 제외)</th>
    </tr>
    </thead>
    <tbody id="studentTableBody">
    <tr><td class="studentName"></td><td>분리배출 종이 (화, 목)</td><td class="weeklyPay">40</td><td></td></tr>
    <tr><td class="studentName"></td><td>분리배출 플라스틱 (화, 목)</td><td class="weeklyPay">40</td><td></td></tr>
    <tr><td class="studentName"></td><td>크롬북 담당 1</td><td class="weeklyPay">40</td><td></td></tr>
    <tr><td class="studentName"></td><td>우유 2 (3교시 갖다놓기)</td><td class="weeklyPay">30</td><td></td></tr>
    <tr><td class="studentName"></td><td>급식 (반찬 1)</td><td class="weeklyPay">70</td><td></td></tr>
    <tr><td class="studentName"></td><td>급식 (반찬 3)</td><td class="weeklyPay">70</td><td></td></tr>
    <tr><td class="studentName"></td><td>잔반담당 1</td><td class="weeklyPay">100</td><td></td></tr>
    <tr><td class="studentName"></td><td>잔반담당 4</td><td class="weeklyPay">100</td><td></td></tr>
    <tr><td class="studentName"></td><td>환기</td><td class="weeklyPay">20</td><td></td></tr>
    <tr><td class="studentName"></td><td>배부, 회람, 택배</td><td class="weeklyPay">40</td><td></td></tr>
    <tr><td class="studentName"></td><td>창문창틀 1</td><td class="weeklyPay">30</td><td></td></tr>
    <tr><td class="studentName"></td><td>[올라운더] 비서 1</td><td class="weeklyPay">60</td><td></td></tr>
    <tr><td class="studentName"></td><td>문단속</td><td class="weeklyPay">20</td><td></td></tr>
    <tr><td class="studentName"></td><td>우산 챙김이 (날씨 요정)</td><td class="weeklyPay">10</td><td></td></tr>
    <tr><td class="studentName"></td><td>복도감독</td><td class="weeklyPay">70</td><td></td></tr>
    <tr><td class="studentName"></td><td>칠판담당</td><td class="weeklyPay">20</td><td></td></tr>
    <tr><td class="studentName"></td><td>계좌 관리</td><td class="weeklyPay">30</td><td></td></tr>
    <tr><td class="studentName"></td><td>우유 1 (배부)</td><td class="weeklyPay">30</td><td></td></tr>
    <tr><td class="studentName"></td><td>급식 (밥)</td><td class="weeklyPay">70</td><td></td></tr>
    <tr><td class="studentName"></td><td>게시판</td><td class="weeklyPay">20</td><td></td></tr>
    <tr><td class="studentName"></td><td>크롬북 담당 2</td><td class="weeklyPay">40</td><td></td></tr>
    <tr><td class="studentName"></td><td>급식 (반찬 2)</td><td class="weeklyPay">70</td><td></td></tr>
    <tr><td class="studentName"></td><td>급식 (국)</td><td class="weeklyPay">80</td><td></td></tr>
    <tr><td class="studentName"></td><td>제출물관리</td><td class="weeklyPay">40</td><td></td></tr>
    <tr><td class="studentName"></td><td>학습준비물실</td><td class="weeklyPay">30</td><td></td></tr>
    <tr><td class="studentName"></td><td>일반쓰레기</td><td class="weeklyPay">50</td><td></td></tr>
    <tr><td class="studentName"></td><td>잔반담당 2</td><td class="weeklyPay">100</td><td></td></tr>
    <tr><td class="studentName"></td><td>잔반담당 3</td><td class="weeklyPay">100</td><td></td></tr>
    <tr><td class="studentName"></td><td>창문창틀 2</td><td class="weeklyPay">30</td><td></td></tr>
    <tr><td class="studentName"></td><td>[올라운더] 비서 2</td><td class="weeklyPay">50</td><td></td></tr>
    <tr><td class="studentName"></td><td>금요앞치마담당 (금요일 요정)</td><td class="weeklyPay">30</td><td></td></tr>
    <tr><td class="studentName"></td><td>청소감독</td><td class="weeklyPay">30</td><td></td></tr>
    </tbody>
</table>

<script>
    const weekdays = ['일', '월', '화', '수', '목', '금', '토'];

    function formatDate(date) {
        const month = date.getMonth() + 1;
        const day = date.getDate();
        const weekday = weekdays[date.getDay()];
        return `${month}월 ${day}일 (${weekday})`;
    }

    function formatWeekRange(startDate, endDate) {
        return `${formatDate(startDate)} - ${formatDate(endDate)}`;
    }

    function getMonday(date) {
        const d = new Date(date);
        const dayOfWeek = d.getDay();
        const daysToSubtract = (dayOfWeek - 1 + 7) % 7;
        const monday = new Date(d);
        monday.setDate(d.getDate() - daysToSubtract);
        monday.setHours(0, 0, 0, 0);
        return monday;
    }

    function cyclicShiftRight(arr, count) {
        const len = arr.length;
        const offset = ((count % len) + len) % len;
        return arr.slice(-offset).concat(arr.slice(0, -offset));
    }


    const originalStudentNames = [
        "김나은","김민지","김준석","김준수","박시연","박준후","백지민","변상민","서현수",
        "송승우","안태은","양우진","오윤하","우나현","이다인","이서준","이승원","이연재",
        "이정인","이준혁","임은후","정재민","조소현","조정우","최석주","최이서","최재원",
        "추서진","한린","황준성","황지우", "김다인"
    ];

    const rotationStartDate = new Date('2025-04-');
    const rotationStartMonday = getMonday(rotationStartDate);
    const todayMonday = getMonday(new Date());
    const weeksPassed = Math.floor((todayMonday - rotationStartMonday) / (1000 * 60 * 60 * 24 * 7));
    const initialShift = weeksPassed % originalStudentNames.length;

    let currentStudentNamesOrder = cyclicShiftRight(originalStudentNames, initialShift);
    let currentMonday = todayMonday;

    const studentNameCells = document.querySelectorAll('#studentTableBody .studentName');
    const weeklyPayCells = document.querySelectorAll('#studentTableBody .weeklyPay');
    const nextWeekButton = document.getElementById('nextWeekButton');
    const frontWeekButton = document.getElementById('frontWeekButton');
    const printButton = document.getElementById('printButton');
    const currentWeekDisplay = document.getElementById('currentWeekDisplay');

    function populateTable(namesOrder) {
        studentNameCells.forEach((cell, index) => {
            cell.textContent = namesOrder[index] || '';
        });
    }

    function displayCurrentWeek() {
        const currentFriday = new Date(currentMonday);
        currentFriday.setDate(currentMonday.getDate() + 4);
        currentWeekDisplay.textContent = formatWeekRange(currentMonday, currentFriday);
    }

    nextWeekButton.addEventListener('click', () => {
        currentStudentNamesOrder = cyclicShiftRight(currentStudentNamesOrder, 1);
        currentMonday.setDate(currentMonday.getDate() + 7);
        populateTable(currentStudentNamesOrder);
        displayCurrentWeek();
    });

    frontWeekButton.addEventListener('click', () => {
        currentStudentNamesOrder = cyclicShiftRight(currentStudentNamesOrder, -1);
        currentMonday.setDate(currentMonday.getDate() - 7);
        populateTable(currentStudentNamesOrder);
        displayCurrentWeek();
    });

    printButton.addEventListener('click', () => window.print());

    // 이름 수정 기능
    studentNameCells.forEach(cell => {
        cell.addEventListener('click', () => {
            const currentName = cell.textContent;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentName;
            input.style.width = '90%';
            cell.textContent = '';
            cell.appendChild(input);

            input.focus();
            function saveRealPaysToLocal() {
                const values = Array.from(realPayCells).map(cell => cell.textContent.trim());
                localStorage.setItem('tempRealPays', JSON.stringify(values));
            }

            input.addEventListener('blur', () => {
                const newName = input.value.trim() || currentName;
                cell.textContent = newName;
                saveCustomNames();
            });

            input.addEventListener('keydown', e => {
                if (e.key === 'Enter') input.blur();
            });
        });
    });

    // 주급 수정 기능
    weeklyPayCells.forEach(cell => {
        cell.addEventListener('click', () => {
            const currentPay = cell.textContent;
            const input = document.createElement('input');
            input.type = 'number';
            input.value = currentPay;
            input.style.width = '60px';
            cell.textContent = '';
            cell.appendChild(input);
            input.focus();

            input.addEventListener('blur', () => {
                const newPay = input.value.trim() || currentPay;
                cell.textContent = newPay;
                saveCustomPay();
            });

            input.addEventListener('keydown', e => {
                if (e.key === 'Enter') input.blur();
            });
        });
    });

    function saveCustomNames() {
        const names = Array.from(studentNameCells).map(cell => cell.textContent);
        localStorage.setItem('customStudentNames', JSON.stringify(names));
    }

    function saveCustomPay() {
        const payValues = Array.from(weeklyPayCells).map(cell => cell.textContent);
        localStorage.setItem('customPayValues', JSON.stringify(payValues));
    }

    function loadCustomNames() {
        const saved = localStorage.getItem('customStudentNames');
        if (saved) {
            const names = JSON.parse(saved);
            if (names.length === studentNameCells.length) {
                names.forEach((name, i) => {
                    studentNameCells[i].textContent = name;
                });
                currentStudentNamesOrder = names;
            }
        }
    }

    function loadCustomPay() {
        const saved = localStorage.getItem('customPayValues');
        if (saved) {
            const values = JSON.parse(saved);
            if (values.length === weeklyPayCells.length) {
                values.forEach((pay, i) => {
                    weeklyPayCells[i].textContent = pay;
                });
            }
        }
    }

    loadCustomNames();
    loadCustomPay();
    populateTable(currentStudentNamesOrder);
    displayCurrentWeek();
    document.getElementById('resetButton').addEventListener('click', () => {
        if (confirm("정말 초기화하시겠습니까?")) {
            localStorage.clear();
            location.reload();
        } }
    )
    const API_KEY = "$2a$10$v8MnmFSL/GoywF.qohAheOJAFCQDPmBW20gtMMHbxdN/zrkvUU1MW";   // 본인 jsonbin.io 마스터키로 교체
    const BIN_ID = "688a2c75ae596e708fbe4cac";     // 저장할 bin ID로 교체

    document.getElementById("saveButton").addEventListener("click", () => {
        const rows = Array.from(document.querySelectorAll('#studentTableBody tr'));

        // 1. 시작 인덱스 찾기 ("김나은")
        const startIndex = rows.findIndex(row => row.cells[0].textContent.trim() === "김나은");

        // 2. 순서를 "김나은"부터 시작해서 나머지를 이어붙임
        const orderedRows = [...rows.slice(startIndex), ...rows.slice(0, startIndex)];

        // 3. 실수령액에서 10% 세금 공제 후 저장
        const result = orderedRows.map(row => {
            const cell = row.cells[3];
            const raw = parseFloat(cell.textContent.trim()) || 0;
            const taxed = Math.round(raw); // 10% 세금 공제, 소수점 2자리
            return taxed.toString();
        });

        // 4. JSON 저장 (jsonbin.io 예시)
        fetch(`https://api.jsonbin.io/v3/b/688a2c75ae596e708fbe4cac`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "X-Master-Key": "$2a$10$v8MnmFSL/GoywF.qohAheOJAFCQDPmBW20gtMMHbxdN/zrkvUU1MW"
            },
            body: JSON.stringify({ realPays: result })
        })
            .then(res => res.json())
            .then(() => alert("저장 완료"))
            .catch(err => alert("저장 실패: " + err.message));
    });
    function test(x) {
        const realPayCells = document.querySelectorAll("#studentTableBody td:nth-child(4)");
        realPayCells.forEach(cell => {
            cell.textContent = x;
        });
    }
    function test1(x){
        const realPayCells = document.querySelectorAll("#studentTableBody td:nth-child(4)");
        realPayCells.forEach(cell => {
            cell.textContent = Math.random()*10241024102410241024
        })
    }

    const realPayCells = document.querySelectorAll('#studentTableBody td:nth-child(4)');

    realPayCells.forEach((cell, index) => {
        cell.addEventListener('click', () => {
            if (cell.querySelector('input')) return;

            const currentValue = cell.textContent.trim();
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentValue;
            input.style.width = '80px';

            cell.textContent = '';
            cell.appendChild(input);
            input.focus();

            // ✅ 방향키 이동 로직
            input.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    input.blur();
                } else if (e.key === 'ArrowDown') {
                    input.blur(); // 현재 input 정리
                    const nextCell = realPayCells[index + 1];
                    if (nextCell) nextCell.click(); // 다음 셀 클릭 유도
                } else if (e.key === 'ArrowUp') {
                    input.blur();
                    const prevCell = realPayCells[index - 1];
                    if (prevCell) prevCell.click();
                }
            });

            input.addEventListener('blur', () => {
                const newValue = input.value.trim();
                cell.textContent = newValue === '' ? currentValue : newValue;
            });
        });
    });

    // 모달 요소
    const modal = document.getElementById("valueModal");
    const modalContent = document.getElementById("modalContent");
    const closeBtn = document.getElementById("closeModal");

    // "값 보기" 버튼 클릭 시
    document.getElementById("viewButton").addEventListener("click", () => {
        fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
            headers: {
                "X-Master-Key": API_KEY
            }
        })
            .then(res => res.json())
            .then(data => {
                const values = data.record.realPays || [];
                modalContent.textContent = JSON.stringify(values, null, 2);
                modal.style.display = "flex"; // 모달 표시
            })
            .catch(err => {
                modalContent.textContent = "데이터 불러오기 실패: " + err.message;
                modal.style.display = "flex";
            });
    });

    // 닫기 버튼 클릭 시
    closeBtn.addEventListener("click", () => {
        modal.style.display = "none";
    });
    document.getElementById('loadFromJsonbinButton').addEventListener('click', () => {
        fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
            headers: {
                "X-Master-Key": API_KEY
            }
        })
            .then(res => res.json())
            .then(data => {
                const values = data.record.realPays;
                if (!Array.isArray(values)) throw new Error("불러온 데이터가 배열이 아닙니다.");

                const rows = Array.from(document.querySelectorAll('#studentTableBody tr'));
                const startIndex = rows.findIndex(row => row.cells[0].textContent.trim() === "김나은");
                if (startIndex === -1) throw new Error("'김나은' 학생을 찾을 수 없습니다.");

                const orderedRows = [...rows.slice(startIndex), ...rows.slice(0, startIndex)];

                values.forEach((val, i) => {
                    if (orderedRows[i]) {
                        const restoredValue = Math.round(val * 10 / 9 * 100) / 100; // 소수점 2자리
                        orderedRows[i].cells[3].textContent = restoredValue;
                    }
                });

                alert("jsonbin.io에서 실수령액 데이터를 원래 지급액으로 복원하여 '김나은'부터 적용했습니다.");

                localStorage.setItem('customRealPays', JSON.stringify(values));
            })
            .catch(err => {
                alert("데이터 불러오기 실패: " + err.message);
            });
    });
    document.getElementById("fillDefaultButton").addEventListener("click", () => {
        const rows = document.querySelectorAll("#studentTableBody tr");
        rows.forEach(row => {
            const weeklyPay = row.cells[2].textContent.trim(); // 주급
            row.cells[3].textContent = weeklyPay;             // 실수령액 칸에 복사
        });
    });


</script>
</body>
</html>
<!--    const API_KEY = "$2a$10$v8MnmFSL/GoywF.qohAheOJAFCQDPmBW20gtMMHbxdN/zrkvUU1MW";   // 본인 jsonbin.io 마스터키로 교체
    const BIN_ID = "688a2c75ae596e708fbe4cac";

fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
  headers: {
    "X-Master-Key": API_KEY
  }
})
.then(res => res.json())
.then(data => {
  const values = data.record.realPays;

  const inputs = Array.from(document.querySelectorAll('input'))
    .filter(input => input.matches('.w-full.border.text-center')); // ← 클래스 이름 기반

  let valIndex = 0;
  inputs.forEach((input, i) => {
    if ((i + 1) % 2 === 0 && valIndex < values.length) {
      input.value = values[valIndex];
      valIndex++;
    }
  });
})
.catch(err => console.error("데이터 로딩 오류:", err));-->

<!--
const incomeTaxBtn = document.querySelector('input[type="submit"][value^="소득세:"]');
if (incomeTaxBtn && incomeTaxBtn.value !== "소득세: OFF") {
  alert(`소득세를 OFF로 변경해주십시오!`);
}else{
document.querySelectorAll('input[name="checked_user_id[]"]').forEach(cb => cb.checked = true);

const API_KEY = "$2a$10$v8MnmFSL/GoywF.qohAheOJAFCQDPmBW20gtMMHbxdN/zrkvUU1MW";   // 본인 jsonbin.io 마스터키로 교체
    const BIN_ID = "688a2c75ae596e708fbe4cac";

fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
  headers: {
    "X-Master-Key": API_KEY
  }
})
.then(res => res.json())
.then(data => {
  const values = data.record.realPays;

  const inputs = Array.from(document.querySelectorAll('input'))
    .filter(input => input.matches('.w-full.border.text-center')); // ← 클래스 이름 기반

  let valIndex = 0;
  inputs.forEach((input, i) => {
    if ((i + 1) % 2 === 0 && valIndex < values.length) {
      input.value = values[valIndex];
      valIndex++;
    }
  });
})
.catch(err => console.error("데이터 로딩 오류:", err));

// 1. 첫 번째 버튼 클릭 (모달 열기)
const openBtn = [...document.querySelectorAll('button')].find(btn => btn.innerText.includes('급여 보내기'));
if (openBtn) {
    openBtn.click();
    console.log('1차 버튼 클릭 완료');

    // 2. 약간 기다린 후 두 번째 버튼 클릭 (모달 내 submit 버튼)
    setTimeout(() => {
        const submitBtn = [...document.querySelectorAll('button')].find(btn =>
            btn.innerText.includes('급여 보내기') &&
            btn.type === 'submit'
        );
        if (submitBtn) {
            submitBtn.click();
            console.log('2차 버튼 클릭 완료');
        } else {
            console.warn('2차 버튼 (submit용) 찾을 수 없음');
        }
    }, 300); // 모달 뜨는 시간만큼 기다림 (필요 시 시간 조절)
} else {
    console.warn('1차 버튼을 찾을 수 없음');
}
}
-->

<!--
const incomeTaxBtn = document.querySelector('input[type="submit"][value^="소득세:"]');
if (incomeTaxBtn && incomeTaxBtn.value !== "소득세: OFF") {
  alert(`소득세를 OFF로 변경해주십시오!`);
} else {
  try {
    document.querySelectorAll('input[name="checked_user_id[]"]').forEach(cb => cb.checked = true);

    const API_KEY = "$2a$10$v8MnmFSL/GoywF.qohAheOJAFCQDPmBW20gtMMHbxdN/zrkvUU1MW"; // 본인 jsonbin.io 마스터키로 교체
    const BIN_ID = "688a2c75ae596e708fbe4cac";

    fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
      headers: {
        "X-Master-Key": API_KEY
      }
    })
    .then(res => {
      if (!res.ok) throw new Error("데이터 요청 실패");
      return res.json();
    })
    .then(data => {
      const values = data.record.realPays;

      const inputs = Array.from(document.querySelectorAll('input'))
        .filter(input => input.matches('.w-full.border.text-center'));

      if (values.length === 0 || inputs.length === 0) throw new Error("입력값 또는 필드 없음");

      let valIndex = 0;
      inputs.forEach((input, i) => {
        if ((i + 1) % 2 === 0 && valIndex < values.length) {
          input.value = values[valIndex];
          valIndex++;
        }
      });

      // 2초 후 다음 작업 시작
      setTimeout(() => {
        try {
          const openBtn = [...document.querySelectorAll('button')].find(btn =>
            btn.innerText.includes('급여 보내기')
          );
          if (!openBtn) throw new Error("1차 버튼을 찾을 수 없음");
          openBtn.click();
          console.log('1차 버튼 클릭 완료');

          // 모달 뜨고 나서 또 약간 기다려서 submit 버튼 클릭
          setTimeout(() => {
            try {
              const submitBtn = [...document.querySelectorAll('button')].find(btn =>
                btn.innerText.includes('급여 보내기') && btn.type === 'submit'
              );
              if (!submitBtn) throw new Error("2차 버튼을 찾을 수 없음");
              submitBtn.click();
              console.log('2차 버튼 클릭 완료');
            } catch (innerErr) {
              console.error("에러:", innerErr.message);
            }
          }, 300);

        } catch (err2) {
          console.error("에러:", err2.message);
        }
      }, 2000);

    })
    .catch(err => {
      console.error("데이터 로딩 오류:", err.message);
    });

  } catch (outerErr) {
    console.error("초기 처리 오류:", outerErr.message);
  }
}
-->

<!--최종 :


const incomeTaxBtn = document.querySelector('input[type="submit"][value^="소득세:"]');
if (incomeTaxBtn && incomeTaxBtn.value !== "소득세: OFF") {
  alert(`소득세를 OFF로 변경해주십시오!`);
} else {
  try {
    document.querySelectorAll('input[name="checked_user_id[]"]').forEach(cb => cb.checked = true);

    const API_KEY = "$2a$10$v8MnmFSL/GoywF.qohAheOJAFCQDPmBW20gtMMHbxdN/zrkvUU1MW"; // 본인 jsonbin.io 마스터키로 교체
    const BIN_ID = "688a2c75ae596e708fbe4cac";

    fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
      headers: {
        "X-Master-Key": API_KEY
      }
    })
    .then(res => {
      if (!res.ok) throw new Error("데이터 요청 실패");
      return res.json();
    })
    .then(data => {
      const values = data.record.realPays;

      const inputs = Array.from(document.querySelectorAll('input'))
        .filter(input => input.matches('.w-full.border.text-center'));

      if (values.length === 0 || inputs.length === 0) throw new Error("입력값 또는 필드 없음");

      let valIndex = 0;
      inputs.forEach((input, i) => {
        if ((i + 1) % 2 === 0 && valIndex < values.length) {
          input.value = values[valIndex];
          valIndex++;
        }
      });

      // 2초 후 다음 작업 시작
      setTimeout(() => {
        try {
          const openBtn = [...document.querySelectorAll('button')].find(btn =>
            btn.innerText.includes('급여 보내기')
          );
          if (!openBtn) throw new Error("1차 버튼을 찾을 수 없음");
          openBtn.click();
          console.log('1차 버튼 클릭 완료');

          // 모달 뜨고 나서 또 약간 기다려서 submit 버튼 클릭
          setTimeout(() => {
            try {
              const submitBtn = [...document.querySelectorAll('button')].find(btn =>
                btn.innerText.includes('급여 보내기') && btn.type === 'submit'
              );
              if (!submitBtn) throw new Error("2차 버튼을 찾을 수 없음");
              submitBtn.click();
              console.log('2차 버튼 클릭 완료');
            } catch (innerErr) {
              console.error("에러:", innerErr.message);
            }
          }, 300);

        } catch (err2) {
          console.error("에러:", err2.message);
        }
      }, 2000);
    })
    .catch(err => {
      console.error("데이터 로딩 오류:", err.message);
    });

  } catch (outerErr) {
    console.error("초기 처리 오류:", outerErr.message);
  }
}
-->
<!--

javascript:(function(){const t=()=>{const s=localStorage.getItem("afterSave");if(s){try{const d=JSON.parse(s);if(Date.now()-d.timestamp>1800000){localStorage.removeItem("afterSave");alert("afterSave가 1시간 지나 초기화되었습니다.");}else{localStorage.removeItem("afterSave");setTimeout(()=>{const b=[...document.querySelectorAll("button")].find(x=>x.innerText.includes("급여 보내기")&&x.type==="submit");b?(b.click(),console.log("✅ 급여 보내기 버튼 자동 클릭 완료")):console.warn("❌ 급여 보내기 버튼 없음")},1000)}}catch{localStorage.removeItem("afterSave")}}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t();const e=document.querySelector(%27input[type="submit"][value^="소득세:"]%27);if(e&&e.value!=="소득세: OFF"){alert("소득세를 OFF로 변경해주십시오!");return}try{document.querySelectorAll(%27input[name="checked_user_id[]"]%27).forEach(c=>c.checked=!0);const n="$2a$10$v8MnmFSL/GoywF.qohAheOJAFCQDPmBW20gtMMHbxdN/zrkvUU1MW",o="688a2c75ae596e708fbe4cac";fetch(`https://api.jsonbin.io/v3/b/${o}/latest`,{headers:{"X-Master-Key":n}}).then(r=>{if(!r.ok)throw new Error("데이터 요청 실패");return r.json()}).then(d=>{const r=d.record.realPays||[],a=Array.from(document.querySelectorAll("input")).filter(i=>i.matches(".w-full.border.text-center"));if(r.length===0||a.length===0)throw new Error("입력값 또는 필드 없음");let c=0,t=new Date,y=t.getFullYear(),m=t.getMonth()+1,D=t.getDate(),f=new Date(y,m-1,1),w=D+f.getDay()-1,u=Math.floor(w/7);if(u===0){m-=1;m===0&&(m=12,y-=1);const t=new Date(y,m-1,1),e=new Date(y,m,0).getDate();u=Math.floor((e+t.getDay()-1)/7)}a.forEach((i,e)=>{e%2===0?i.value=`${m}월 ${u}주차`:c<r.length&&(i.value=r[c++])});setTimeout(()=>{try{const b=[...document.querySelectorAll("button")].find(b=>b.textContent.includes("저장하기")&&b.getAttribute("onclick")?.includes("/adminPage/jobSetting/saveJob"));if(!b)throw new Error("저장하기 버튼을 찾을 수 없음");localStorage.setItem("afterSave",JSON.stringify({timestamp:Date.now()}));alert("확인을 누른 후 북마크를 다시 눌러주십시오!");b.click()}catch(t){console.error("저장하기 클릭 에러:",t.message)}},1000)}).catch(e=>console.error("데이터 로딩 오류:",e.message))}catch(e){console.error("초기 처리 오류:",e.message)}})();-->

<!--
javascript:(function(){const t=()=>{const s=localStorage.getItem('afterSave');if(s){try{const d=JSON.parse(s);if(Date.now()-d.timestamp>1800000){localStorage.removeItem('afterSave');alert('afterSave가 1시간 지나 초기화되었습니다.');}else{localStorage.removeItem('afterSave');setTimeout(()=>{const b=[...document.querySelectorAll('button')].find(x=>x.innerText.includes('급여 보내기')&&x.type==='submit');b?(b.click(),console.log(%27✅ 급여 보내기 버튼 자동 클릭 완료%27)):console.warn(%27❌ 급여 보내기 버튼 없음%27)},1000)}}catch{localStorage.removeItem(%27afterSave%27)}}};document.readyState===%27loading%27?document.addEventListener(%27DOMContentLoaded%27,t):t();const e=document.querySelector(%27input[type="submit"][value^="소득세:"]%27);if(e&&e.value!==%27소득세: ON%27){alert(%27소득세를 ON로 변경해주십시오!%27);return}try{document.querySelectorAll(%27input[name="checked_user_id[]"]%27).forEach(c=>c.checked=!0);const n=%27$2a$10$v8MnmFSL/GoywF.qohAheOJAFCQDPmBW20gtMMHbxdN/zrkvUU1MW%27,o=%27688a2c75ae596e708fbe4cac%27;fetch(`https://api.jsonbin.io/v3/b/${o}/latest`,{headers:{%27X-Master-Key%27:n}}).then(r=>{if(!r.ok)throw new Error(%27데이터 요청 실패%27);return r.json()}).then(d=>{const r=d.record.realPays||[],a=Array.from(document.querySelectorAll(%27input%27)).filter(i=>i.matches(%27.w-full.border.text-center%27));if(r.length===0||a.length===0)throw new Error(%27입력값 또는 필드 없음%27);let c=0,t=new Date,y=t.getFullYear(),m=t.getMonth()+1,D=t.getDate(),f=new Date(y,m-1,1),w=D+f.getDay()-1,u=Math.floor(w/7);if(u===0){m-=1;m===0&&(m=12,y-=1);const t=new Date(y,m-1,1),e=new Date(y,m,0).getDate();u=Math.floor((e+t.getDay()-1)/7)}a.forEach((i,e)=>{e%2===0?i.value=`${m}월 ${u}주차`:c<r.length&&(i.value=r[c++])});setTimeout(()=>{try{const b=[...document.querySelectorAll(%27button%27)].find(b=>b.textContent.includes(%27저장하기%27)&&b.getAttribute(%27onclick%27)?.includes(%27/adminPage/jobSetting/saveJob%27));if(!b)throw new Error(%27저장하기 버튼을 찾을 수 없음%27);localStorage.setItem(%27afterSave%27,JSON.stringify({timestamp:Date.now()}));alert(%27확인을 누른 후 북마크를 다시 눌러주십시오!%27);b.click()}catch(t){console.error(%27저장하기 클릭 에러:%27,t.message)}},1000)}).catch(e=>console.error(%27데이터 로딩 오류:%27,e.message))}catch(e){console.error(%27초기 처리 오류:%27,e.message)}})();
-->
